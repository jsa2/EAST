{
    "ControlId": "\nAKS Workload security checklist\n",
    "Category": "Protection",
    "Description": "\n\nThe security of workloads running on AKS should be reviewed for following areas described on the table for Pod Security.\n\n**Pod Security Table**\n\n---\n\nitem|status | YAML | AzPolicy\n-|-|-|-\nPods should run as non-root /non-privileged|❌ / ✔ | **spec.securityContext** <br> ``privileged: false``  <br>       ``runAsNonRoot:true`` <br> ``allowPrivilegeEscalation: false`` | ``Kubernetes clusters should disable automounting API credentials: Audit / Deny`` \nPod Filesystem access should be read-only or limited only for specifed writes |❌ / ✔ | **spec.securityContext** <br> ``readOnlyRootFilesystem: true`` \nPod actions should be limited with appArmor |❌ / ✔ | **metadata.annotations** <br> ``container.apparmor.security.beta.kubernetes.io/v5: runtime/default`` \nPod should be disabled for automation of API credentials |❌ / ✔  | **spec** <br> `` automountServiceAccountToken: false `` \nPod hostPath mounts should only allow predefined mounts, and preferably not used at all (By default Azure Policy audits all hostPath mounts as non compliant, to block hostPath mounts the policy needs to be changed) | ❌ / ✔ | **spec.Volumes** <br> `` hostPath: <Only allowed values here defined in Azure Policy> ``  \nAzure Container Registry and vulnerability scanning should be used for container images | ❌ / ✔ | **spec.containers** <br> `` image: <yourACRRegistry>.azurecr.io/<yourImage>``  \n\n**Example of healthy PODspec**\n\nRead-only container with secretsProvider Mount ¹ \n\n¹ alternative to Pod identity and runtime calls to Azure key Vault, which is even more secure, but requires code to be aware of the Azure Key Vault Calls.\n\n\n```YAML \napiVersion: v1\nkind: Pod\nmetadata:\n  name: demorce\n  annotations:\n    container.apparmor.security.beta.kubernetes.io/v5: runtime/default\nspec:\n  automountServiceAccountToken: false\n  containers:\n    - name: v5\n      image: acraksa.azurecr.io/v5rce:latest\n      ports:\n        - containerPort: 8443\n      resources:\n          limits:\n            cpu: 100m\n            memory: 250Mi\n      securityContext:\n        privileged: false\n        readOnlyRootFilesystem: true\n        allowPrivilegeEscalation: false\n        runAsNonRoot: true\n        runAsUser: 1000\n      volumeMounts:\n        - name: secrets-store01-inline\n          mountPath: /mnt/secrets-store\n          readOnly: true\n  volumes:\n      - name: secrets-store01-inline\n        csi:\n          driver: secrets-store.csi.k8s.io\n          readOnly: true\n          volumeAttributes:\n            secretProviderClass: azure-kvname-user-msi \n\n```\n--- \n\n"
}